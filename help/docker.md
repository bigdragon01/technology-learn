mac 安装docker  
brew install docker安装后，报Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
Updating Homebrew...
==> Auto-updated Homebrew!
Updated 2 taps (homebrew/core, homebrew/services).
==> New Formulae
cafeobj                     gnunet                      i386-elf-grub               re-flex                     sd                          stolon                      v2ray-plugin
dockerize                   homeassistant-cli           kcov                        riff                        serve                       triangle                    zydis
==> Updated Formulae
erlang ✔                    cmark-gfm                   dwm                         gsettings-desktop-schemas   libsecret                   paket                       solr@5.5
openssl@1.1 ✔               cointop                     dyld-headers                gtk+3                       libsoup                     pandoc                      sourcery
akamai                      collada-dom                 dynamips                    gtranslator                 libtensorflow               pandoc-citeproc             speedtest-cli
ammonite-repl               collector-sidecar           eccodes                     gucharmap                   libuninameslist             parallel                    sphinx-doc
amqp-cpp                    commandbox                  elasticsearch@5.6           gwyddion                    libxlsxwriter               parallelstl                 spotbugs
angular-cli                 conan                       elektra                     hdf5                        libyaml                     passenger                   sqlmap
annie                       configen                    embulk                      hebcal                      linkerd                     pdftoedn                    sundials
apache-arrow                confluent-oss               emscripten                  helmfile                    lmod                        percona-server              supersonic
apache-arrow-glib           consul-template             erlang@20                   ibex                        logtalk                     pgweb                       svgo
apache-flink                convox                      eslint                      imagemagick                 lolcat                      php                         swagger-codegen
apache-zeppelin             coreutils                   exiftool                    immortal                    lsd                         picard-tools                swagger-codegen@2
apktool                     coturn                      exploitdb                   instead                     ltc-tools                   plank                       swiftformat
app-engine-java             couchdb                     faas-cli                    ipfs                        lxc                         platformio                  swiftlint
armadillo                   cpprestsdk                  fabio                       ispc                        lzlib                       pmd                         syncthing
asdf                        cproto                      fastqc                      jadx                        mandoc                      ponyc                       telegraf
at-spi2-atk                 crc32c                      fifechan                    jasper                      mat2                        powerman                    template-glib
at-spi2-core                cromwell                    file-roller                 jenkins                     maxwell                     pre-commit                  terraform
atk                         cryptominisat               firebase-cli                jenv                        mesa                        precomp                     terraform-inventory
auditbeat                   cryptopp                    flake8                      jetty                       metricbeat                  prometheus                  terragrunt
aws-sdk-cpp                 cscope                      flann                       jetty-runner                micronaut                   protobuf                    tgui
awscli                      csfml                       flow                        jhipster                    minio-mc                    protobuf-c                  thrift
axel                        cython                      fluid-synth                 jo                          mkl-dnn                     protobuf-swift              tile38
azure-cli                   czmq                        fn                          joplin                      mlkit                       protoc-gen-go               tippecanoe
baobab                      darcs                       freetds                     jruby                       mmark                       pulumi                      tmux-xpanes
batik                       dartsim                     frugal                      jsonrpc-glib                moarvm                      pygobject3                  tomcat-native
bazel                       dav1d                       fwup                        juju                        monero                      python@2                    tomcat@8
bettercap                   davix                       fx                          kafka                       monit                       rakudo                      topgrade
binaryen                    dcd                         gambit-scheme               kibana@5.6                  mono                        redis@4.0                   treefrog
bind                        ddrescue                    gdal                        kitchen-sync                mosh                        rhash                       ucloud
bit                         deark                       gdk-pixbuf                  knot                        mosquitto                   rke                         unbound
brew-php-switcher           debianutils                 geckodriver                 kompose                     mpd                         roswell                     unrar
bundletool                  deja-gnu                    gecode                      kops                        mutt                        rst-lint                    unzip
bzt                         dep                         gedit                       krakend                     mysql@5.6                   rtags                       v8
caddy                       deployer                    gerbil-scheme               kube-ps1                    needle                      rust                        vagrant-completion
caffe                       dhex                        ghc                         kubernetes-cli              neo4j                       rustup-init                 vala
calicoctl                   dialog                      git-flow-avh                kubernetes-helm             netcdf                      salt                        valabind
cargo-completion            diffoscope                  git-lfs                     kustomize                   netpbm                      sbcl                        vault
cash-cli                    diffstat                    gjs                         lcov                        nginx                       scrcpy                      vim
cassandra@2.1               digdag                      glib                        ldc                         nifi                        scw                         vte3
cassandra@2.2               dita-ot                     glib-networking             lean-cli                    node                        serveit                     wartremover
cataclysm                   django-completion           glslang                     leiningen                   node-build                  serverless                  weboob
cdk                         dmd                         gmsh                        libbi                       node@10                     sfml                        wildfly-as
cdogs-sdl                   dmenu                       gmt                         libcerf                     node@6                      shadowsocks-libev           winetricks
certbot                     docfx                       gmt@4                       libdazzle                   node@8                      shellshare                  wireguard-tools
cfengine                    docker                      gnome-builder               libdvdread                  nqp                         ship                        wolfssl
cflow                       docker-completion           gnome-latex                 libgosu                     nspr                        shmux                       wtf
cfr-decompiler              double-conversion           go                          libgtop                     nss                         siege                       xmrig
cglm                        dovecot                     gobject-introspection       libgweather                 ntp                         simple-scan                 yelp-tools
chakra                      dpkg                        godep                       libheif                     numpy                       singular                    yle-dl
check_postgres              draco                       golang-migrate              libosinfo                   ocrmypdf                    sip                         you-get
checkstyle                  dscanner                    gomplate                    libphonenumber              octave                      skaffold                    youtube-dl
chkrootkit                  dtc                         goreleaser                  libpq                       ohcount                     skinny                      zbackup
cli53                       dub                         grafana                     libpulsar                   opentracing-cpp             skopeo
click                       duck                        grpc                        libqalculate                osquery                     sn0int
closure-compiler            dwdiff                      grpcurl                     librealsense                packer                      solr
==> Renamed Formulae
ark -> velero                                                                                       gloo-ctl -> glooctl
==> Deleted Formulae
gdnsd

==> Downloading https://homebrew.bintray.com/bottles/docker-18.09.3.sierra.bottle.tar.gz
######################################################################## 100.0%
==> Pouring docker-18.09.3.sierra.bottle.tar.gz
==> Caveats
Bash completion has been installed to:
  /usr/local/etc/bash_completion.d

zsh completions have been installed to:
  /usr/local/share/zsh/site-functions
==> Summary
🍺  /usr/local/Cellar/docker/18.09.3: 8 files, 72.2MB

解决办法：
brew cask install docker

建议下载docker安装包后直接手动安装。https://download.docker.com/mac/stable/Docker.dmg

redis镜像包构建过程：
IMAGE                                                                     CREATED             CREATED BY                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        SIZE                COMMENT
sha256:b1e8850a2b94403d712643d2a2cedb31956a1e1f211d9793410ee5e9547aa7eb   9 days ago          /bin/sh -c #(nop)  CMD ["redis-server"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           0B                  
<missing>                                                                 9 days ago          /bin/sh -c #(nop)  EXPOSE 6379                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0B                  
<missing>                                                                 9 days ago          /bin/sh -c #(nop)  ENTRYPOINT ["docker-entrypoint.sh"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            0B                  
<missing>                                                                 9 days ago          /bin/sh -c #(nop) COPY file:df205a0ef6e6df8947ce0a7ae9e37b6a5588035647f38a49b8b07321003a8a01 in /usr/local/bin/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   374B                
<missing>                                                                 9 days ago          /bin/sh -c #(nop) WORKDIR /data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0B                  
<missing>                                                                 9 days ago          /bin/sh -c #(nop)  VOLUME [/data]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0B                  
<missing>                                                                 9 days ago          /bin/sh -c mkdir /data && chown redis:redis /data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 0B                  
<missing>                                                                 9 days ago          /bin/sh -c set -ex;   buildDeps='   wget     gcc   libc6-dev   make  ';  apt-get update;  apt-get install -y $buildDeps --no-install-recommends;  rm -rf /var/lib/apt/lists/*;   wget -O redis.tar.gz "$REDIS_DOWNLOAD_URL";  echo "$REDIS_DOWNLOAD_SHA *redis.tar.gz" | sha256sum -c -;  mkdir -p /usr/src/redis;  tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1;  rm redis.tar.gz;   grep -q '^#define CONFIG_DEFAULT_PROTECTED_MODE 1$' /usr/src/redis/src/server.h;  sed -ri 's!^(#define CONFIG_DEFAULT_PROTECTED_MODE) 1$!\1 0!' /usr/src/redis/src/server.h;  grep -q '^#define CONFIG_DEFAULT_PROTECTED_MODE 0$' /usr/src/redis/src/server.h;   make -C /usr/src/redis -j "$(nproc)";  make -C /usr/src/redis install;   rm -r /usr/src/redis;   apt-get purge -y --auto-remove $buildDeps                                                                 24.8MB              
<missing>                                                                 9 days ago          /bin/sh -c #(nop)  ENV REDIS_DOWNLOAD_SHA=17d955227966dcd68590be6139e5fe7f2d19fc4fb7334248a904ea9cdd30c1d4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        0B                  
<missing>                                                                 9 days ago          /bin/sh -c #(nop)  ENV REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-4.0.13.tar.gz                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0B                  
<missing>                                                                 9 days ago          /bin/sh -c #(nop)  ENV REDIS_VERSION=4.0.13                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       0B                  
<missing>                                                                 9 days ago          /bin/sh -c set -ex;   fetchDeps="   ca-certificates   dirmngr   gnupg   wget  ";  apt-get update;  apt-get install -y --no-install-recommends $fetchDeps;  rm -rf /var/lib/apt/lists/*;   dpkgArch="$(dpkg --print-architecture | awk -F- '{ print $NF }')";  wget -O /usr/local/bin/gosu "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch";  wget -O /usr/local/bin/gosu.asc "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc";  export GNUPGHOME="$(mktemp -d)";  gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4;  gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu;  gpgconf --kill all;  rm -r "$GNUPGHOME" /usr/local/bin/gosu.asc;  chmod +x /usr/local/bin/gosu;  gosu nobody true;   apt-get purge -y --auto-remove $fetchDeps   3MB                 
<missing>                                                                 9 days ago          /bin/sh -c #(nop)  ENV GOSU_VERSION=1.10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0B                  
<missing>                                                                 9 days ago          /bin/sh -c groupadd -r redis && useradd -r -g redis redis                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         329kB               
<missing>                                                                 9 days ago          /bin/sh -c #(nop)  CMD ["bash"]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0B                  
<missing>                                                                 9 days ago          /bin/sh -c #(nop) ADD file:5ea7dfe8c8bc87ebe0d06d275bce41e015310bdfc04546246302e9ce07ee416c in /                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  55.3MB              

workdir设置的是命令执行的路径
编辑Dockerfile，在对应目录下docker build --no-cache -t redis:nding_v1 .  
docker exec -i -t redis:nding_v1 /bin/sh，可以进入容器，查看目录结构
docker run， -p 6379:6379 -v /tmp/redis:/tmp/redis  前面为宿主机的，后面为容器的，-p设置端口映射，不设置情况对expose的端口，宿主机端口为随机的；通过docker port查看  
-v 目录挂栽点。volume设置的为容器中的目录，宿主机的为生成的，路径为/var/lib/docker/volumes/4495de62484346a2ef120b95113593058c678ed64504534e31d48afd76017f4d/_data。通过docker inspect 查看Mounts

redis镜像中docker-entrypoint.sh内容
#!/bin/sh
set -e

# first arg is `-f` or `--some-option`
# or first arg is `something.conf`
if [ "${1#-}" != "$1" ] || [ "${1%.conf}" != "$1" ]; then
	set -- redis-server "$@"
fi

# allow the container to be started with `--user`
if [ "$1" = 'redis-server' -a "$(id -u)" = '0' ]; then
	find . \! -user redis -exec chown redis '{}' +
	exec gosu redis "$0" "$@"
fi

exec "$@"

